{
  "hash": "563c6ffb579907be6cfa6c3967ee69dc",
  "result": {
    "markdown": "---\ntitle: \"Instrumental Variables\"\nauthor: \"Lucas Puebla\"\n---\n\n\n# Assignment 1\n\n\n::: {.cell hash='09_iv_cache/html/unnamed-chunk-1_fcf67b7fc65bc66cfd6db7c3ad6287b6'}\n\n```{.r .cell-code}\n# Load packages\nlibrary(tidyverse)\nlibrary(dagitty)\nlibrary(ggdag)\nlibrary(ggthemr)\nlibrary(AER)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n#> Loading required package: car\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n#> Loading required package: carData\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n#> \n#> Attaching package: 'car'\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n#> The following object is masked from 'package:dplyr':\n#> \n#>     recode\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n#> The following object is masked from 'package:purrr':\n#> \n#>     some\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n#> Loading required package: lmtest\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n#> Loading required package: zoo\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n#> \n#> Attaching package: 'zoo'\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n#> The following objects are masked from 'package:base':\n#> \n#>     as.Date, as.Date.numeric\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n#> Loading required package: sandwich\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n#> Loading required package: survival\n```\n:::\n\n```{.r .cell-code}\nggthemr(\"flat\")\nrm(list = ls())\n\n# Load data\ndata <- readRDS(\"~/GitHub/cdsba-lucaspuebla93/Causal_Data_Science_Data/rand_enc.rds\")\nprint(data)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> # A tibble: 10,000 × 3\n#>    rand_enc used_ftr time_spent\n#>       <int>    <int>      <dbl>\n#>  1        0        1       30.5\n#>  2        0        0       19.8\n#>  3        1        1       28.6\n#>  4        0        0       18.6\n#>  5        0        0       14.6\n#>  6        1        0       12.4\n#>  7        0        1       27.2\n#>  8        0        0       29.2\n#>  9        1        0       12.3\n#> 10        0        0       17.3\n#> # ℹ 9,990 more rows\n```\n:::\n\n```{.r .cell-code}\n# Define the DAG model with chosen relations and custom positions\ncustom_dag_model <- 'dag {\n  \"unobservable\" [pos=\"0.5,0.75\"]\n  \"rand_enc\" [pos=\"0,0.5\"]\n  \"used_ftr\" [pos=\"0.25,0.5\"]\n  \"time_spent\" [pos=\"0.75,0.5\"]\n  \"unobservable\" -> \"used_ftr\"\n  \"unobservable\" -> \"time_spent\"\n  \"rand_enc\" -> \"used_ftr\"\n  \"used_ftr\" -> \"time_spent\"\n}'\n\n# Plot the updated custom DAG using ggdag\nggdag(custom_dag_model) +\n  geom_dag_point(color = \"blue\") +\n  geom_dag_text(color = \"black\") +\n  geom_dag_edges(edge_color = \"black\")\n```\n\n::: {.cell-output-display}\n![](09_iv_files/figure-html/unnamed-chunk-1-1.png){width=672}\n:::\n:::\n\n\n\n# Assignment 2\n\n\n::: {.cell hash='09_iv_cache/html/unnamed-chunk-2_3ac848fab3b5453e21a9f6ccd6f20ced'}\n\n```{.r .cell-code}\n# Calculate the naive, biased estimate\nnaive_biased_estimate <- data %>%\n  filter(used_ftr == 1) %>%\n  group_by(rand_enc) %>%\n  summarise(mean_time_spent = mean(time_spent))\n\nnaive_biased_estimate\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"rand_enc\"],\"name\":[1],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"mean_time_spent\"],\"name\":[2],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"0\",\"2\":\"29.88281\"},{\"1\":\"1\",\"2\":\"29.58088\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n\n# Assignment 3\n\n\n::: {.cell hash='09_iv_cache/html/unnamed-chunk-3_5a4e955951c150c3f6f4dba8cd2910d8'}\n\n```{.r .cell-code}\n# Compute correlations\ncorrelation_matrix <- data %>%\n  select(rand_enc, used_ftr, time_spent) %>%\n  cor()\n\ncorrelation_matrix\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#>             rand_enc  used_ftr time_spent\n#> rand_enc   1.0000000 0.2044110  0.1296716\n#> used_ftr   0.2044110 1.0000000  0.7050147\n#> time_spent 0.1296716 0.7050147  1.0000000\n```\n:::\n:::\n\nThe correlation coefficient between rand_enc and time_spent indicates that there might be a small but not very relevant influence of rand_enc on time_spent, therefore affirming the Relevance assumption.\n\nThe correlation coefficient between rand_enc and time_spent is also small, also indicating that the Excludability assumption is probably correct.\n\n# Assignment 4\n\n\n::: {.cell hash='09_iv_cache/html/unnamed-chunk-4_62f8d9c5dbe37878ead0415cca0abe25'}\n\n```{.r .cell-code}\n# Perform 2SLS regression\n# I am using ivreg instead of iv_robust because I am getting library errors\niv_model <- ivreg(time_spent ~ used_ftr | rand_enc, data = data)\n\n# Summary of the IV regression\nsummary(iv_model)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> \n#> Call:\n#> ivreg(formula = time_spent ~ used_ftr | rand_enc, data = data)\n#> \n#> Residuals:\n#>     Min      1Q  Median      3Q     Max \n#> -20.937  -3.622   0.061   3.568  20.063 \n#> \n#> Coefficients:\n#>             Estimate Std. Error t value Pr(>|t|)    \n#> (Intercept)  19.3124     0.2249   85.86   <2e-16 ***\n#> used_ftr      9.7382     0.5353   18.19   <2e-16 ***\n#> ---\n#> Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n#> \n#> Residual standard error: 5.377 on 9998 degrees of freedom\n#> Multiple R-Squared: 0.4921,\tAdjusted R-squared: 0.492 \n#> Wald test:   331 on 1 and 9998 DF,  p-value: < 2.2e-16\n```\n:::\n:::\n\nIt appears that the naive estimate for the encouraged group (29.9) has a significant upwards bias compared to the IV estimate (9.7), indicating that the naive estimate overestimates the true effect of the treatment variable on time spent using the app for the encouraged users.\n\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../../site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\r\n<script src=\"../../site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\r\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}