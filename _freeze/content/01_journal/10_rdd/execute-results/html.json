{
  "hash": "0c6db9d49180dee2cacf035a8880b3c9",
  "result": {
    "markdown": "---\ntitle: \"Regression Discontinuity\"\nauthor: \"Lucas Puebla\"\n---\n\n\n# Assignment 1\n\n\n::: {.cell hash='10_rdd_cache/html/unnamed-chunk-1_76dd9d3a0c51ff8eaa25b4d5adfcd2b6'}\n\n```{.r .cell-code}\n# Load packages\nlibrary(tidyverse)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n#> ── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──\n#> ✔ dplyr     1.1.4     ✔ readr     2.1.4\n#> ✔ forcats   1.0.0     ✔ stringr   1.5.0\n#> ✔ ggplot2   3.4.4     ✔ tibble    3.2.1\n#> ✔ lubridate 1.9.3     ✔ tidyr     1.3.0\n#> ✔ purrr     1.0.2     \n#> ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n#> ✖ dplyr::filter() masks stats::filter()\n#> ✖ dplyr::lag()    masks stats::lag()\n#> ℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors\n```\n:::\n\n```{.r .cell-code}\nlibrary(dagitty)\nlibrary(ggdag)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n#> \n#> Attaching package: 'ggdag'\n#> \n#> The following object is masked from 'package:stats':\n#> \n#>     filter\n```\n:::\n\n```{.r .cell-code}\nlibrary(ggthemr)\nlibrary(AER)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n#> Loading required package: car\n#> Loading required package: carData\n#> \n#> Attaching package: 'car'\n#> \n#> The following object is masked from 'package:dplyr':\n#> \n#>     recode\n#> \n#> The following object is masked from 'package:purrr':\n#> \n#>     some\n#> \n#> Loading required package: lmtest\n#> Loading required package: zoo\n#> \n#> Attaching package: 'zoo'\n#> \n#> The following objects are masked from 'package:base':\n#> \n#>     as.Date, as.Date.numeric\n#> \n#> Loading required package: sandwich\n#> Loading required package: survival\n```\n:::\n\n```{.r .cell-code}\nlibrary(rdd)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n#> Loading required package: Formula\n```\n:::\n\n```{.r .cell-code}\nggthemr(\"flat\")\nrm(list = ls())\n\n# Load data\ndata <- readRDS(\"~/GitHub/cdsba-lucaspuebla93/Causal_Data_Science_Data/coupon.rds\")\nprint(data)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> # A tibble: 5,000 × 4\n#>    days_since_last days_since_last_centered coupon purchase_after\n#>              <dbl>                    <dbl> <lgl>           <dbl>\n#>  1            82                      22    TRUE            22.8 \n#>  2            39                     -21    FALSE           11.6 \n#>  3             7.2                   -52.8  FALSE           16.0 \n#>  4           116.                     55.6  TRUE            20.5 \n#>  5            17                     -43    FALSE            8.90\n#>  6            42.8                   -17.2  FALSE            6.72\n#>  7            62.2                     2.20 TRUE            22.7 \n#>  8            55.7                    -4.30 FALSE            9.74\n#>  9            39.7                   -20.3  FALSE           12.4 \n#> 10            53.5                    -6.5  FALSE            6.45\n#> # ℹ 4,990 more rows\n```\n:::\n\n```{.r .cell-code}\n# Specify bandwidth range around the cutoff point\ncutoff_point <- 60  \nbandwidth <- cutoff_point + c(-5, 5)\nbandwidth_half <- cutoff_point + c(-2.5, 2.5)\nbandwidth_double <- cutoff_point + c(-10, 10)\n\n# Create subsets based on different bandwidths\ndata_subset <- subset(data, abs(days_since_last_centered) <= bandwidth)\ndata_half_bw <- subset(data, abs(days_since_last_centered) <= bandwidth_half)\ndata_double_bw <- subset(data, abs(days_since_last_centered) <= bandwidth_double)\n\n# Perform RDD analysis without squared term\nrdd_model <- lm(purchase_after ~ days_since_last_centered + coupon, data = data_subset)\nsummary(rdd_model)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> \n#> Call:\n#> lm(formula = purchase_after ~ days_since_last_centered + coupon, \n#>     data = data_subset)\n#> \n#> Residuals:\n#>      Min       1Q   Median       3Q      Max \n#> -14.4489  -2.4681  -0.2268   2.0487  26.2562 \n#> \n#> Coefficients:\n#>                           Estimate Std. Error t value Pr(>|t|)    \n#> (Intercept)               9.161458   0.134429   68.15   <2e-16 ***\n#> days_since_last_centered -0.089198   0.003507  -25.43   <2e-16 ***\n#> couponTRUE               13.148511   0.237883   55.27   <2e-16 ***\n#> ---\n#> Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n#> \n#> Residual standard error: 3.773 on 4652 degrees of freedom\n#> Multiple R-squared:  0.481,\tAdjusted R-squared:  0.4808 \n#> F-statistic:  2156 on 2 and 4652 DF,  p-value: < 2.2e-16\n```\n:::\n\n```{.r .cell-code}\n# Perform RDD analysis for half the bandwidth\nrdd_half_bw <- lm(purchase_after ~ days_since_last_centered + coupon, data = data_half_bw)\nsummary(rdd_half_bw)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> \n#> Call:\n#> lm(formula = purchase_after ~ days_since_last_centered + coupon, \n#>     data = data_half_bw)\n#> \n#> Residuals:\n#>     Min      1Q  Median      3Q     Max \n#> -14.662  -2.504  -0.249   2.108  25.893 \n#> \n#> Coefficients:\n#>                          Estimate Std. Error t value Pr(>|t|)    \n#> (Intercept)               8.97662    0.13570   66.15   <2e-16 ***\n#> days_since_last_centered -0.09849    0.00348  -28.30   <2e-16 ***\n#> couponTRUE               13.54609    0.23917   56.64   <2e-16 ***\n#> ---\n#> Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n#> \n#> Residual standard error: 3.825 on 4769 degrees of freedom\n#> Multiple R-squared:  0.4701,\tAdjusted R-squared:  0.4699 \n#> F-statistic:  2115 on 2 and 4769 DF,  p-value: < 2.2e-16\n```\n:::\n\n```{.r .cell-code}\n# Perform RDD analysis for double the bandwidth\nrdd_double_bw <- lm(purchase_after ~ days_since_last_centered + coupon, data = data_double_bw)\nsummary(rdd_double_bw)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> \n#> Call:\n#> lm(formula = purchase_after ~ days_since_last_centered + coupon, \n#>     data = data_double_bw)\n#> \n#> Residuals:\n#>     Min      1Q  Median      3Q     Max \n#> -14.409  -2.467  -0.247   2.028  26.357 \n#> \n#> Coefficients:\n#>                           Estimate Std. Error t value Pr(>|t|)    \n#> (Intercept)               9.235019   0.135824   67.99   <2e-16 ***\n#> days_since_last_centered -0.086248   0.003647  -23.65   <2e-16 ***\n#> couponTRUE               13.035000   0.242710   53.71   <2e-16 ***\n#> ---\n#> Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n#> \n#> Residual standard error: 3.808 on 4426 degrees of freedom\n#> Multiple R-squared:  0.4888,\tAdjusted R-squared:  0.4886 \n#> F-statistic:  2116 on 2 and 4426 DF,  p-value: < 2.2e-16\n```\n:::\n:::\n\nThe estimated treatment effects and coefficients (related to the running variable and the coupon) appear to be robust and consistent, showing little sensitivity to changes in bandwidth.\n\n\n# Assignment 2\n\n\n::: {.cell hash='10_rdd_cache/html/unnamed-chunk-2_bf4e2b196b546e5d704280e9e46915f3'}\n\n```{.r .cell-code}\n# Load data\ndata <- readRDS(\"~/GitHub/cdsba-lucaspuebla93/Causal_Data_Science_Data/shipping.rds\")\nprint(data)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> # A tibble: 6,666 × 1\n#>    purchase_amount\n#>              <dbl>\n#>  1           13.1 \n#>  2           37.1 \n#>  3           11.3 \n#>  4            9.45\n#>  5           53.2 \n#>  6           20.5 \n#>  7            4.53\n#>  8           19.4 \n#>  9           31.8 \n#> 10            1.81\n#> # ℹ 6,656 more rows\n```\n:::\n\n```{.r .cell-code}\n# Plotting a density plot to visualize the distribution around the 30€ cutoff\nlibrary(ggplot2)  # Loading the ggplot2 package for visualization\n\n# Create a density plot for purchase_amount\nggplot(data, aes(x = purchase_amount)) +\n  geom_density(fill = \"skyblue\", color = \"black\") +\n  geom_vline(xintercept = 30, linetype = \"dashed\", color = \"red\") +  # Adding a vertical line at 30€ cutoff\n  labs(x = \"Purchase Amount\", y = \"Density\", title = \"Density Plot of Purchase Amount with Cutoff at 30€\")\n```\n\n::: {.cell-output-display}\n![](10_rdd_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n:::\n\n\nThe density plot suggests a non-smooth distribution of observations around the 30€ cutoff, showing multiple peaks rather than a smooth density.\nThe discontinuity observed in the density plot might affect the validity of using purchase_amount as a running variable in RDD analysis, as the assumptions of continuity and density might not hold precisely around the cutoff point.\n\n\n\n\n\n\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../../site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\r\n<script src=\"../../site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\r\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}