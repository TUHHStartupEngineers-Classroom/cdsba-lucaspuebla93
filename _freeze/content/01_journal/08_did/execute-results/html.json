{
  "hash": "02939482e050c3c540dd1b279e2aba48",
  "result": {
    "markdown": "---\ntitle: \"Difference-in-Differences\"\nauthor: \"Lucas Puebla\"\n---\n\n\n# Assignment 1\n\n\n::: {.cell hash='08_did_cache/html/unnamed-chunk-1_35a687370e8c1086da720e48e7a16699'}\n\n```{.r .cell-code}\n# Load packages\nlibrary(tidyverse)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n#> ── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──\n#> ✔ dplyr     1.1.4     ✔ readr     2.1.4\n#> ✔ forcats   1.0.0     ✔ stringr   1.5.0\n#> ✔ ggplot2   3.4.4     ✔ tibble    3.2.1\n#> ✔ lubridate 1.9.3     ✔ tidyr     1.3.0\n#> ✔ purrr     1.0.2     \n#> ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n#> ✖ dplyr::filter() masks stats::filter()\n#> ✖ dplyr::lag()    masks stats::lag()\n#> ℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors\n```\n:::\n\n```{.r .cell-code}\nlibrary(dagitty)\nlibrary(ggdag)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n#> \n#> Attaching package: 'ggdag'\n#> \n#> The following object is masked from 'package:stats':\n#> \n#>     filter\n```\n:::\n\n```{.r .cell-code}\nlibrary(ggthemr)\nlibrary(dplyr)\nggthemr(\"flat\")\nrm(list = ls())\n\n# Load data\ndata <- readRDS(\"~/GitHub/cdsba-lucaspuebla93/Causal_Data_Science_Data/hospdd.rds\")\nprint(data)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> # A tibble: 7,368 × 5\n#>    hospital frequency month procedure satis\n#>       <dbl> <int>     <int> <dbl>     <dbl>\n#>  1        1 3         7     1          4.11\n#>  2        1 2         3     0          3.32\n#>  3        1 4         2     0          3.41\n#>  4        1 2         4     1          3.00\n#>  5        1 1         3     0          3.11\n#>  6        1 1         7     1          2.88\n#>  7        1 2         4     1          4.41\n#>  8        1 4         1     0          2.90\n#>  9        1 2         3     0          3.05\n#> 10        1 2         1     0          2.44\n#> # ℹ 7,358 more rows\n```\n:::\n\n```{.r .cell-code}\nsummary(data)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#>     hospital       frequency         month         procedure     \n#>  Min.   : 1.00   Min.   :1.000   Min.   :1.000   Min.   :0.0000  \n#>  1st Qu.:11.00   1st Qu.:1.000   1st Qu.:1.750   1st Qu.:0.0000  \n#>  Median :23.00   Median :2.000   Median :3.500   Median :0.0000  \n#>  Mean   :22.84   Mean   :2.473   Mean   :3.625   Mean   :0.2079  \n#>  3rd Qu.:35.00   3rd Qu.:4.000   3rd Qu.:5.250   3rd Qu.:0.0000  \n#>  Max.   :46.00   Max.   :4.000   Max.   :7.000   Max.   :1.0000  \n#>      satis       \n#>  Min.   :0.5468  \n#>  1st Qu.:2.8888  \n#>  Median :3.4975  \n#>  Mean   :3.6191  \n#>  3rd Qu.:4.2405  \n#>  Max.   :9.7129\n```\n:::\n\n```{.r .cell-code}\n# Filter data for treated and control groups before and after treatment\ntreated_before <- data %>%\n  filter(hospital <= 18, procedure == 0) %>%  # Before procedure for treated\n  summarise(mean_satisfaction_before = mean(satis))\n\ntreated_after <- data %>%\n  filter(hospital <= 18, procedure == 1) %>%  # After procedure for treated\n  summarise(mean_satisfaction_after = mean(satis))\n\ncontrol_before <- data %>%\n  filter(hospital > 18, procedure == 0) %>%  # Before procedure for control\n  summarise(mean_satisfaction_before = mean(satis))\n\n# Display the computed means\ntreated_before\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"mean_satisfaction_before\"],\"name\":[1],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"3.525383\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n\n```{.r .cell-code}\ntreated_after\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"mean_satisfaction_after\"],\"name\":[1],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"4.363351\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n\n```{.r .cell-code}\ncontrol_before\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"mean_satisfaction_before\"],\"name\":[1],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"3.387499\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n\n# Assignment 2\n\n\n::: {.cell hash='08_did_cache/html/unnamed-chunk-2_ca8c5b5b351fdfc34fec52c62109d012'}\n\n```{.r .cell-code}\n# Perform difference-in-differences analysis with fixed effects\nmodel <- lm(satis ~ as.factor(procedure) * as.factor(hospital) + as.factor(month), data = data)\n\n# View the summary of the regression results\nsummary(model)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> \n#> Call:\n#> lm(formula = satis ~ as.factor(procedure) * as.factor(hospital) + \n#>     as.factor(month), data = data)\n#> \n#> Residuals:\n#>     Min      1Q  Median      3Q     Max \n#> -3.1303 -0.4627  0.0048  0.4559  4.2750 \n#> \n#> Coefficients: (28 not defined because of singularities)\n#>                                              Estimate Std. Error t value\n#> (Intercept)                                  3.223895   0.076378  42.210\n#> as.factor(procedure)1                        0.743510   0.108947   6.825\n#> as.factor(hospital)2                         0.288897   0.109201   2.646\n#> as.factor(hospital)3                         0.452987   0.112165   4.039\n#> as.factor(hospital)4                         0.311332   0.104535   2.978\n#> as.factor(hospital)5                        -0.274068   0.104535  -2.622\n#> as.factor(hospital)6                         0.368605   0.104535   3.526\n#> as.factor(hospital)7                         1.335041   0.101021  13.215\n#> as.factor(hospital)8                         0.047233   0.107896   0.438\n#> as.factor(hospital)9                        -1.551302   0.110619 -14.024\n#> as.factor(hospital)10                        1.572914   0.109201  14.404\n#> as.factor(hospital)11                        0.162248   0.107896   1.504\n#> as.factor(hospital)12                       -0.073736   0.110619  -0.667\n#> as.factor(hospital)13                        0.462809   0.106690   4.338\n#> as.factor(hospital)14                        0.141160   0.112165   1.259\n#> as.factor(hospital)15                       -0.300102   0.112165  -2.676\n#> as.factor(hospital)16                        1.376744   0.109201  12.607\n#> as.factor(hospital)17                        0.368000   0.113859   3.232\n#> as.factor(hospital)18                        0.222772   0.132633   1.680\n#> as.factor(hospital)19                       -0.797540   0.096218  -8.289\n#> as.factor(hospital)20                       -0.004851   0.094498  -0.051\n#> as.factor(hospital)21                        1.142098   0.098301  11.618\n#> as.factor(hospital)22                        0.747077   0.097207   7.685\n#> as.factor(hospital)23                        0.649481   0.096218   6.750\n#> as.factor(hospital)24                       -0.360365   0.100879  -3.572\n#> as.factor(hospital)25                        0.594235   0.106148   5.598\n#> as.factor(hospital)26                        0.162008   0.094498   1.714\n#> as.factor(hospital)27                       -0.450893   0.092413  -4.879\n#> as.factor(hospital)28                        0.659757   0.098301   6.712\n#> as.factor(hospital)29                        0.196312   0.095319   2.060\n#> as.factor(hospital)30                       -0.220161   0.108458  -2.030\n#> as.factor(hospital)31                        0.459846   0.094498   4.866\n#> as.factor(hospital)32                       -0.375584   0.095319  -3.940\n#> as.factor(hospital)33                       -0.506214   0.094498  -5.357\n#> as.factor(hospital)34                       -0.052651   0.090759  -0.580\n#> as.factor(hospital)35                        0.301872   0.092413   3.267\n#> as.factor(hospital)36                        2.085904   0.093052  22.416\n#> as.factor(hospital)37                        0.088165   0.106148   0.831\n#> as.factor(hospital)38                       -0.139045   0.093745  -1.483\n#> as.factor(hospital)39                       -0.075736   0.097207  -0.779\n#> as.factor(hospital)40                        1.069294   0.093745  11.406\n#> as.factor(hospital)41                       -0.201973   0.092413  -2.186\n#> as.factor(hospital)42                        0.828898   0.099518   8.329\n#> as.factor(hospital)43                       -0.824671   0.096218  -8.571\n#> as.factor(hospital)44                       -0.017827   0.104153  -0.171\n#> as.factor(hospital)45                       -0.265988   0.092413  -2.878\n#> as.factor(hospital)46                        0.026253   0.097207   0.270\n#> as.factor(month)2                           -0.009608   0.029202  -0.329\n#> as.factor(month)3                            0.021969   0.029202   0.752\n#> as.factor(month)4                           -0.003284   0.032483  -0.101\n#> as.factor(month)5                           -0.009403   0.032483  -0.289\n#> as.factor(month)6                           -0.003838   0.032483  -0.118\n#> as.factor(month)7                           -0.011194   0.032483  -0.345\n#> as.factor(procedure)1:as.factor(hospital)2   0.239339   0.154433   1.550\n#> as.factor(procedure)1:as.factor(hospital)3   0.161277   0.158625   1.017\n#> as.factor(procedure)1:as.factor(hospital)4  -0.167644   0.147834  -1.134\n#> as.factor(procedure)1:as.factor(hospital)5   0.257429   0.147834   1.741\n#> as.factor(procedure)1:as.factor(hospital)6   0.158518   0.147834   1.072\n#> as.factor(procedure)1:as.factor(hospital)7   0.138750   0.142866   0.971\n#> as.factor(procedure)1:as.factor(hospital)8   0.049285   0.152588   0.323\n#> as.factor(procedure)1:as.factor(hospital)9   0.065573   0.156439   0.419\n#> as.factor(procedure)1:as.factor(hospital)10  0.219861   0.154433   1.424\n#> as.factor(procedure)1:as.factor(hospital)11  0.117435   0.152588   0.770\n#> as.factor(procedure)1:as.factor(hospital)12 -0.043134   0.156439  -0.276\n#> as.factor(procedure)1:as.factor(hospital)13  0.065568   0.150883   0.435\n#> as.factor(procedure)1:as.factor(hospital)14  0.183765   0.158625   1.158\n#> as.factor(procedure)1:as.factor(hospital)15  0.311218   0.158625   1.962\n#> as.factor(procedure)1:as.factor(hospital)16  0.075049   0.154433   0.486\n#> as.factor(procedure)1:as.factor(hospital)17  0.111086   0.161020   0.690\n#> as.factor(procedure)1:as.factor(hospital)18 -0.138991   0.187572  -0.741\n#> as.factor(procedure)1:as.factor(hospital)19        NA         NA      NA\n#> as.factor(procedure)1:as.factor(hospital)20        NA         NA      NA\n#> as.factor(procedure)1:as.factor(hospital)21        NA         NA      NA\n#> as.factor(procedure)1:as.factor(hospital)22        NA         NA      NA\n#> as.factor(procedure)1:as.factor(hospital)23        NA         NA      NA\n#> as.factor(procedure)1:as.factor(hospital)24        NA         NA      NA\n#> as.factor(procedure)1:as.factor(hospital)25        NA         NA      NA\n#> as.factor(procedure)1:as.factor(hospital)26        NA         NA      NA\n#> as.factor(procedure)1:as.factor(hospital)27        NA         NA      NA\n#> as.factor(procedure)1:as.factor(hospital)28        NA         NA      NA\n#> as.factor(procedure)1:as.factor(hospital)29        NA         NA      NA\n#> as.factor(procedure)1:as.factor(hospital)30        NA         NA      NA\n#> as.factor(procedure)1:as.factor(hospital)31        NA         NA      NA\n#> as.factor(procedure)1:as.factor(hospital)32        NA         NA      NA\n#> as.factor(procedure)1:as.factor(hospital)33        NA         NA      NA\n#> as.factor(procedure)1:as.factor(hospital)34        NA         NA      NA\n#> as.factor(procedure)1:as.factor(hospital)35        NA         NA      NA\n#> as.factor(procedure)1:as.factor(hospital)36        NA         NA      NA\n#> as.factor(procedure)1:as.factor(hospital)37        NA         NA      NA\n#> as.factor(procedure)1:as.factor(hospital)38        NA         NA      NA\n#> as.factor(procedure)1:as.factor(hospital)39        NA         NA      NA\n#> as.factor(procedure)1:as.factor(hospital)40        NA         NA      NA\n#> as.factor(procedure)1:as.factor(hospital)41        NA         NA      NA\n#> as.factor(procedure)1:as.factor(hospital)42        NA         NA      NA\n#> as.factor(procedure)1:as.factor(hospital)43        NA         NA      NA\n#> as.factor(procedure)1:as.factor(hospital)44        NA         NA      NA\n#> as.factor(procedure)1:as.factor(hospital)45        NA         NA      NA\n#> as.factor(procedure)1:as.factor(hospital)46        NA         NA      NA\n#>                                             Pr(>|t|)    \n#> (Intercept)                                  < 2e-16 ***\n#> as.factor(procedure)1                       9.53e-12 ***\n#> as.factor(hospital)2                        0.008173 ** \n#> as.factor(hospital)3                        5.43e-05 ***\n#> as.factor(hospital)4                        0.002908 ** \n#> as.factor(hospital)5                        0.008765 ** \n#> as.factor(hospital)6                        0.000424 ***\n#> as.factor(hospital)7                         < 2e-16 ***\n#> as.factor(hospital)8                        0.661568    \n#> as.factor(hospital)9                         < 2e-16 ***\n#> as.factor(hospital)10                        < 2e-16 ***\n#> as.factor(hospital)11                       0.132691    \n#> as.factor(hospital)12                       0.505061    \n#> as.factor(hospital)13                       1.46e-05 ***\n#> as.factor(hospital)14                       0.208250    \n#> as.factor(hospital)15                       0.007477 ** \n#> as.factor(hospital)16                        < 2e-16 ***\n#> as.factor(hospital)17                       0.001234 ** \n#> as.factor(hospital)18                       0.093077 .  \n#> as.factor(hospital)19                        < 2e-16 ***\n#> as.factor(hospital)20                       0.959058    \n#> as.factor(hospital)21                        < 2e-16 ***\n#> as.factor(hospital)22                       1.72e-14 ***\n#> as.factor(hospital)23                       1.59e-11 ***\n#> as.factor(hospital)24                       0.000356 ***\n#> as.factor(hospital)25                       2.24e-08 ***\n#> as.factor(hospital)26                       0.086494 .  \n#> as.factor(hospital)27                       1.09e-06 ***\n#> as.factor(hospital)28                       2.07e-11 ***\n#> as.factor(hospital)29                       0.039478 *  \n#> as.factor(hospital)30                       0.042401 *  \n#> as.factor(hospital)31                       1.16e-06 ***\n#> as.factor(hospital)32                       8.21e-05 ***\n#> as.factor(hospital)33                       8.72e-08 ***\n#> as.factor(hospital)34                       0.561852    \n#> as.factor(hospital)35                       0.001094 ** \n#> as.factor(hospital)36                        < 2e-16 ***\n#> as.factor(hospital)37                       0.406234    \n#> as.factor(hospital)38                       0.138058    \n#> as.factor(hospital)39                       0.435937    \n#> as.factor(hospital)40                        < 2e-16 ***\n#> as.factor(hospital)41                       0.028880 *  \n#> as.factor(hospital)42                        < 2e-16 ***\n#> as.factor(hospital)43                        < 2e-16 ***\n#> as.factor(hospital)44                       0.864103    \n#> as.factor(hospital)45                       0.004011 ** \n#> as.factor(hospital)46                       0.787114    \n#> as.factor(month)2                           0.742164    \n#> as.factor(month)3                           0.451904    \n#> as.factor(month)4                           0.919478    \n#> as.factor(month)5                           0.772233    \n#> as.factor(month)6                           0.905960    \n#> as.factor(month)7                           0.730394    \n#> as.factor(procedure)1:as.factor(hospital)2  0.121235    \n#> as.factor(procedure)1:as.factor(hospital)3  0.309323    \n#> as.factor(procedure)1:as.factor(hospital)4  0.256834    \n#> as.factor(procedure)1:as.factor(hospital)5  0.081667 .  \n#> as.factor(procedure)1:as.factor(hospital)6  0.283636    \n#> as.factor(procedure)1:as.factor(hospital)7  0.331483    \n#> as.factor(procedure)1:as.factor(hospital)8  0.746709    \n#> as.factor(procedure)1:as.factor(hospital)9  0.675110    \n#> as.factor(procedure)1:as.factor(hospital)10 0.154587    \n#> as.factor(procedure)1:as.factor(hospital)11 0.441547    \n#> as.factor(procedure)1:as.factor(hospital)12 0.782766    \n#> as.factor(procedure)1:as.factor(hospital)13 0.663892    \n#> as.factor(procedure)1:as.factor(hospital)14 0.246704    \n#> as.factor(procedure)1:as.factor(hospital)15 0.049804 *  \n#> as.factor(procedure)1:as.factor(hospital)16 0.627009    \n#> as.factor(procedure)1:as.factor(hospital)17 0.490286    \n#> as.factor(procedure)1:as.factor(hospital)18 0.458716    \n#> as.factor(procedure)1:as.factor(hospital)19       NA    \n#> as.factor(procedure)1:as.factor(hospital)20       NA    \n#> as.factor(procedure)1:as.factor(hospital)21       NA    \n#> as.factor(procedure)1:as.factor(hospital)22       NA    \n#> as.factor(procedure)1:as.factor(hospital)23       NA    \n#> as.factor(procedure)1:as.factor(hospital)24       NA    \n#> as.factor(procedure)1:as.factor(hospital)25       NA    \n#> as.factor(procedure)1:as.factor(hospital)26       NA    \n#> as.factor(procedure)1:as.factor(hospital)27       NA    \n#> as.factor(procedure)1:as.factor(hospital)28       NA    \n#> as.factor(procedure)1:as.factor(hospital)29       NA    \n#> as.factor(procedure)1:as.factor(hospital)30       NA    \n#> as.factor(procedure)1:as.factor(hospital)31       NA    \n#> as.factor(procedure)1:as.factor(hospital)32       NA    \n#> as.factor(procedure)1:as.factor(hospital)33       NA    \n#> as.factor(procedure)1:as.factor(hospital)34       NA    \n#> as.factor(procedure)1:as.factor(hospital)35       NA    \n#> as.factor(procedure)1:as.factor(hospital)36       NA    \n#> as.factor(procedure)1:as.factor(hospital)37       NA    \n#> as.factor(procedure)1:as.factor(hospital)38       NA    \n#> as.factor(procedure)1:as.factor(hospital)39       NA    \n#> as.factor(procedure)1:as.factor(hospital)40       NA    \n#> as.factor(procedure)1:as.factor(hospital)41       NA    \n#> as.factor(procedure)1:as.factor(hospital)42       NA    \n#> as.factor(procedure)1:as.factor(hospital)43       NA    \n#> as.factor(procedure)1:as.factor(hospital)44       NA    \n#> as.factor(procedure)1:as.factor(hospital)45       NA    \n#> as.factor(procedure)1:as.factor(hospital)46       NA    \n#> ---\n#> Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n#> \n#> Residual standard error: 0.7236 on 7298 degrees of freedom\n#> Multiple R-squared:  0.5346,\tAdjusted R-squared:  0.5302 \n#> F-statistic: 121.5 on 69 and 7298 DF,  p-value: < 2.2e-16\n```\n:::\n:::\n\nThe notation \"month + hospital\" treats months and hospitals as continuous variables, which is not the case. Therefore, \"as.factor(month) + as.factor(hospital)\" is used to treat them as categorical variables\n\n\n\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../../site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\r\n<script src=\"../../site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\r\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}